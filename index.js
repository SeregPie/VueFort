!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue-demi")):"function"==typeof define&&define.amd?define(["exports","vue-demi"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VueFort={},e.VueDemi)}(this,(function(e,t){"use strict";const n=()=>{},o=Array.isArray,i=e=>"function"==typeof e,s=e=>"string"==typeof e,l=e=>null!==e&&"object"==typeof e;let f,r=new WeakMap;function a(e){if(f){let{effects:t}=r.get(f);t.add(e)}}function c(e){if(function(e){return!(null==e||!e.$isEffect)}(e)){let{stop:t}=e;t()}else if(function(e){return r.has(e)}(e)){let{stop:t}=r.get(e);t()}}function u(e,o){return function(e){let o,s;return i(e)?(o=e,s=n):({get:o,set:s}=e),t.customRef((()=>({get:o,set:s})))}({get:()=>e[o],set(t){e[o]=t}})}let d=new WeakMap;function h(e){let n={};if(l(e))if(t.isReactive(e)){let o=d.get(e);o||(o={},d.set(e,o));let i=t.toRaw(e);t.isReadonly(e)?Object.keys(e).forEach((s=>{let l=o[s];if(!l){if(t.isReactive(i))l=t.shallowReadonly(u(e,s));else{let n=i[s];l=t.isRef(n)?t.isReadonly(n)?n:t.shallowReadonly(n):t.shallowReadonly(u(e,s))}o[s]=l}n[s]=l})):Object.keys(e).forEach((s=>{let l=o[s];if(!l){if(t.isReactive(i))l=u(e,s);else{let n=i[s];l=t.isRef(n)?n:u(e,s)}o[s]=l}n[s]=l}))}else t.isReadonly(e)?(e=t.toRaw(e),Object.entries(e).forEach((([e,o])=>{n[e]=t.isRef(o)?t.isReadonly(o)?o:t.shallowReadonly(o):t.shallowReadonly(t.shallowRef(o))}))):Object.entries(e).forEach((([e,o])=>{n[e]=t.isRef(o)?o:t.shallowRef(o)}));return n}function y(e,n,f){if(o(f))f.forEach((t=>{y(e,n,t)}));else{let o,r;s(f)?o=e[f]:i(f)?o=f.bind(e):l(f)&&(({handler:f,...r}=f),s(f)?o=e[f]:i(f)&&(o=f.bind(e))),function(...e){let n=t.watch(...e);a({$isEffect:!0,stop:n})}(n,o,r)}}function p(e){return e.startsWith("_")}function b(e,o){let s={},l=function(e){let n=[],o=e=>{n.push(e)},i={},s=new Set;r.set(i,{effects:s,stop(){s.forEach((e=>{c(e)})),n.forEach((e=>{e()}))}}),a(i);{let t=f;f=i;try{Object.assign(i,e(o))}finally{f=t}}return t.getCurrentInstance()&&t.onUnmounted((()=>{c(i)})),i}((f=>{let r={},{options:{state:u=n,getters:d={},watch:b={},methods:R={}}={}}=e,g=h(o);Object.entries({...g,...h(u({...g}))}).forEach((([e,t])=>{r[e]={get:()=>t.value,set(e){t.value=e}}})),Object.entries(d).forEach((([e,o])=>{let l=function(e){let o,s;i(e)?(o=e,s=n):({get:o,set:s}=e);let l={$isEffect:!0,stop:n};return a(l),t.customRef(((e,n)=>{let i;return{get:()=>(i||(l.stop=t.watch(o,(e=>{i?((e,t)=>e!==t&&(e==e||t==t))(i.value,e)&&(i.value=e,n()):i={value:e}}),{flush:"sync",immediate:!0})),e(),i.value),set:s}}))}(o.bind(s));r[e]={get:()=>l.value}})),Object.entries(R).forEach((([e,t])=>{r[e]={value:t.bind(s)}})),Object.entries(r).forEach((([e,t])=>{Object.assign(t,{enumerable:!p(e)})}));let j=!1;f((()=>{j=!0})),Object.assign(r,{$model:{value:e},$destroy:{value(){c(l)}},$isDestroyed:{get:()=>j}}),Object.defineProperties(s,r),Object.entries(b).forEach((([e,t])=>{let n=function(e,t){let n=t.split(".");return 1===n.length?()=>e[t]:()=>function(e,t){return t.forEach((t=>{e=e[t]})),e}(e,n)}(s,e);y(s,n,t)}))}));return s}e.defineModel=function(e){let t=function(...e){return b(t,...e)};return Object.defineProperties(t,{options:{get:()=>e}}),t},e.toRefs=h,Object.defineProperty(e,"__esModule",{value:!0})}));
